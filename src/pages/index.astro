---
import Layout from '../layouts/Layout.astro';
import { format } from 'date-fns';
import { getCollection } from 'astro:content';
import '../styles/global.css';

const baseUrl = import.meta.env.BASE_URL;

// Fetch all talks from the content collection
const allTalks = await getCollection('talks');

// Sort talks by date (newest first) and get the description from the content body
const talks = allTalks
  .map(talk => ({
    ...talk.data,
    description: talk.body || '',
    slug: talk.id,
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<Layout title="Flutter Talks Collection">
  <div class="space-y-8">
    <div class="text-center py-10">
      <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-2 drop-shadow">The Best Flutter Talks of 2024 âœ¨</h1>
      <p class="text-lg md:text-xl text-blue-100 mb-6">Discover, share, and celebrate the best Flutter talks from around the world.</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
        <button 
          onclick="window.dispatchEvent(new CustomEvent('open-modal'))"
          class="inline-block px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-full shadow-lg hover:from-purple-700 hover:to-blue-700 transition"
        >
          ðŸš€ Submit a Talk
        </button>
        <a href={`${baseUrl}contribute/`} class="inline-block px-6 py-3 bg-white text-purple-800 font-bold rounded-full shadow hover:bg-blue-100 transition">Learn How to Contribute</a>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {talks.map((talk) => (
        <article class="bg-white rounded-2xl shadow-lg overflow-hidden hover:scale-105 hover:shadow-2xl transition-transform duration-200">
          <a href={talk.videoUrl} target="_blank" rel="noopener noreferrer" class="block">
            <img
              src={talk.thumbnail}
              alt={talk.title}
              class="w-full aspect-video object-cover bg-gray-200"
            />
            <div class="p-4">
              <h2 class="text-lg font-bold text-purple-900 mb-1">{talk.title}</h2>
              <p class="text-xs text-blue-700 mb-1">{talk.event}</p>
              <p class="text-xs text-gray-500 mb-2">{format(new Date(talk.date), 'MMMM d, yyyy')}</p>
              <div class="flex flex-wrap gap-2 mb-2">
                {talk.tags.map((tag) => (
                  <span key={tag} class="px-2 py-0.5 bg-purple-700 text-white text-xs rounded-full font-semibold">{tag}</span>
                ))}
              </div>
              <p class="text-xs text-gray-700">{talk.description?.replace(/\n/g, ' ').substring(0, 150)}...</p>
            </div>
          </a>
        </article>
      ))}
    </div>
  </div>
</Layout>
